name: "Clippier Matrix Generator"
description: "Generate CI matrices and analyze package dependencies using clippier"
author: "MoosicBox"

inputs:
    command:
        description: "Clippier command to run (features, packages, affected-packages, workspace-deps, validate-feature-propagation, setup, run-matrix, run-matrix-flush)"
        required: true

    workspace-path:
        description: "Path to workspace/package"
        required: false
        default: "."

    os:
        description: "Target operating system"
        required: false

    offset:
        description: "Skip first N features"
        required: false

    max:
        description: "Maximum number of features"
        required: false

    max-parallel:
        description: "Maximum parallel jobs"
        required: false

    chunked:
        description: "Group features into chunks"
        required: false

    spread:
        description: "Spread features across jobs"
        required: false
        default: "false"

    randomize:
        description: "Randomize features before chunking/spreading"
        required: false
        default: "false"

    seed:
        description: "Seed for deterministic randomization"
        required: false

    features:
        description: "Specific features to include (comma-separated)"
        required: false

    skip-features:
        description: "Features to exclude/skip (comma-separated, supports glob patterns like 'test-*', '*-codec'). For validate-feature-propagation, defaults to 'default,_*' if not specified. Supports negation with '!' prefix"
        required: false

    strict-optional:
        description: "Require strict optional dependency propagation syntax (for validate-feature-propagation command). When enabled, optional dependencies MUST use 'dep?/feature' syntax. When disabled (default), accepts both 'dep?/feature' and 'dep/feature'"
        required: false
        default: "false"

    required-features:
        description: "Always-required features (comma-separated)"
        required: false

    packages:
        description: "Specific packages to process (comma-separated)"
        required: false

    skip-if:
        description: "Skip packages matching Cargo.toml property filters (can be specified multiple times, comma or newline-separated)"
        required: false

    include-if:
        description: "Include only packages matching Cargo.toml property filters (can be specified multiple times, comma or newline-separated)"
        required: false

    changed-files:
        description: "List of changed files (comma-separated)"
        required: false

    git-strategy:
        description: "Git comparison strategy: auto (detect event type), workflow-history (use GitHub API), branch-comparison (compare against branch), or manual (use provided base/head)"
        required: false
        default: "auto"

    git-base:
        description: "Git base commit (only used when git-strategy is manual)"
        required: false

    git-head:
        description: "Git head commit (only used when git-strategy is manual)"
        required: false

    git-compare-branch:
        description: "Branch to compare against (for branch-comparison strategy)"
        required: false
        default: "master"

    git-workflow-name:
        description: "Workflow name for API lookups (defaults to current workflow)"
        required: false

    git-default-branch:
        description: "Default branch name"
        required: false
        default: "master"

    github-token:
        description: "GitHub token for API access (for workflow-history strategy)"
        required: false
        default: ${{ github.token }}

    github-repository:
        description: "Repository (owner/repo) for API lookups"
        required: false
        default: ${{ github.repository }}

    github-ref-name:
        description: "Current ref name for API lookups"
        required: false
        default: ${{ github.ref_name }}

    include-reasoning:
        description: "Include reasoning for why packages are affected"
        required: false
        default: "false"

    ignore:
        description: 'Glob patterns to ignore when detecting affected packages (newline or comma-separated, e.g., "**/*.md")'
        required: false

    target-package:
        description: "Package to check if affected (for affected-packages command)"
        required: false

    package:
        description: "Target package name (for workspace-deps command)"
        required: false

    all-potential-deps:
        description: "Include all potential workspace dependencies"
        required: false
        default: "false"

    additional-package-checks:
        description: "JSON array of additional package checks with summary configuration"
        required: false

    inject-reasoning:
        description: "Custom reasoning to inject into all packages"
        required: false

    inject-reasoning-condition:
        description: "Condition to inject reasoning (evaluates as bash condition)"
        required: false
        default: "true"

    force-full-matrix-condition:
        description: "Condition to force full matrix generation regardless of changes"
        required: false

    skip-on-no-changes:
        description: "Skip matrix generation if no changes detected"
        required: false
        default: "true"

    transform-name-regex:
        description: 'Regex substitution for package name (e.g., "^(moosicbox|switchy|hyperchad)_")'
        required: false

    transform-name-replacement:
        description: "Replacement string for name regex"
        required: false
        default: ""

    matrix-properties:
        description: "Comma-separated list of properties to include in matrix"
        required: false
        default: "name,path,features,requiredFeatures,os,dependencies,toolchains,ciSteps,ciToolchains,env,nightly,gitSubmodules,cargo"

    os-suffix:
        description: 'Suffix to add to OS field (e.g., "-latest")'
        required: false
        default: "-latest"

    generate-summary:
        description: "Generate GitHub workflow summary"
        required: false
        default: "false"

    summary-title:
        description: "Title for the summary section"
        required: false
        default: "Smart CI Analysis Summary"

    summary-include-seed:
        description: "Include randomization seed in summary"
        required: false
        default: "true"

    summary-event-name:
        description: "GitHub event name for summary context"
        required: false
        default: ${{ github.event_name }}

    summary-ref-name:
        description: "GitHub ref name for summary context"
        required: false
        default: ${{ github.ref_name }}

    summary-trigger-input:
        description: "Workflow input that triggered the run (for workflow_dispatch)"
        required: false

    summary-show-trigger:
        description: "Show trigger information in summary"
        required: false
        default: "true"

    summary-show-jobs-details:
        description: "Show detailed job breakdown in summary (OS, features, etc.)"
        required: false
        default: "false"

    generate-validation-summary:
        description: "Generate validation results summary for validate-feature-propagation command"
        required: false
        default: "true"

    enable-docker-analysis:
        description: "Enable Docker package analysis and matrix generation"
        required: false
        default: "false"

    docker-packages:
        description: "JSON mapping of packages to Docker info"
        required: false

    docker-name-prefix:
        description: "Prefix to add when looking up Docker packages"
        required: false
        default: ""

    transform-scripts:
        description: "Lua transform scripts to apply to matrix (comma-separated paths relative to workspace root)"
        required: false

    transform-trace:
        description: "Enable trace mode for transform debugging"
        required: false
        default: "false"

    clippier-version:
        description: "Git ref/tag for clippier (default: use from current repo)"
        required: false
        default: "master"

    clippier-features:
        description: "Features to enable when building clippier"
        required: false
        default: "git-diff,transforms-vendored"

    cache-key-prefix:
        description: "Prefix for cache key"
        required: false
        default: "clippier"

    skip-cache:
        description: "Skip caching clippier binary"
        required: false
        default: "false"

    package-json:
        description: "JSON object containing matrix.package properties (for setup command)"
        required: false

    skip-checkout:
        description: "Skip repository checkout step (for setup command when already checked out)"
        required: false
        default: "false"

    checkout-fetch-depth:
        description: "Git fetch depth for checkout (for setup command)"
        required: false
        default: "0"

    rust-components:
        description: "Rust components to install (for setup command)"
        required: false
        default: "rustfmt, clippy"

    # Inputs for run-matrix command
    run-matrix-package-json:
        description: "Package JSON from matrix (same format as package-json for setup)"
        required: false

    run-matrix-commands:
        description: |
            Command templates to run (one per line or comma-separated).
            Use {{matrix.package.*}} for matrix properties and {{clippier.*}} for generated values.

            Examples:
            - cargo clippy --all-targets {{clippier.feature-flags}}
            - cargo test --doc {{clippier.feature-flags}}
            - {{if matrix.package.env}}{{matrix.package.env}} {{endif}}cargo build {{clippier.feature-flags}}

            Multiple commands can be specified:
            commands: |
                cargo clippy --all-targets {{clippier.feature-flags}}
                cargo test {{clippier.feature-flags}}
                cargo test --doc {{clippier.feature-flags}}
        required: false
        default: |
            cargo{{if matrix.package.nightly}} +nightly{{endif}} clippy --all-targets --no-default-features {{clippier.feature-flags}} {{matrix.package.cargo}}
            cargo{{if matrix.package.nightly}} +nightly{{endif}} llvm-cov test --no-report --no-default-features {{clippier.feature-flags}} {{matrix.package.cargo}}
            cargo{{if matrix.package.nightly}} +nightly{{endif}} test --doc --no-default-features {{clippier.feature-flags}} {{matrix.package.cargo}}

    run-matrix-strategy:
        description: |
            How to combine feature combinations:
            - sequential: Run one feature at a time (default)
            - parallel: Run all features in parallel (background jobs)
            - combined: Combine all features into a single run
            - chunked-N: Combine N features per run (e.g., chunked-3)
        required: false
        default: "sequential"

    run-matrix-continue-on-failure:
        description: "Continue running all feature combinations even when some fail"
        required: false
        default: "true"

    run-matrix-max-output-lines:
        description: "Maximum lines of output to capture per failure (0 = unlimited)"
        required: false
        default: "200"

    run-matrix-fail-fast:
        description: "Stop on first failure (overrides continue-on-failure)"
        required: false
        default: "false"

    run-matrix-verbose:
        description: "Show all commands and output as they run"
        required: false
        default: "false"

    run-matrix-stream-output:
        description: "Stream command output to console in real-time (true/false)"
        required: false
        default: "true"

    run-matrix-working-directory:
        description: "Working directory for commands (defaults to matrix.package.path)"
        required: false

    run-matrix-label:
        description: "Custom label for this test run (shown in summary)"
        required: false

    run-matrix-skip-doctest-check:
        description: "Skip checking for lib target before running doctests"
        required: false
        default: "false"

    run-matrix-generate-summary:
        description: "Generate GitHub Actions step summary with results"
        required: false
        default: "true"

    run-matrix-summary-auto-expand:
        description: "Auto-expand summary details (always, failures, never)"
        required: false
        default: "failures"

    run-matrix-debug-shells:
        description: "Comma-separated list of shell formats for debug reproduction commands (bash, fish, zsh). Default: bash"
        required: false
        default: "bash"

    run-matrix-summary-mode:
        description: "Summary mode: individual (default), combined, or group:<name>"
        required: false
        default: "individual"

    run-matrix-summary-only-on-failure:
        description: "Only generate summary if there are failures (no output when all tests pass)"
        required: false
        default: "false"

    run-matrix-summary-flush:
        description: "Whether to flush accumulated summaries (for combined/group modes)"
        required: false
        default: "false"

    run-matrix-prepare-upload:
        description: "Prepare failure artifact for upload with unique filename (used with run-matrix-flush)"
        required: false
        default: "false"

    run-matrix-prepare-upload-only-on-failure:
        description: "Only prepare upload artifact if there are failures (default: false for backwards compatibility)"
        required: false
        default: "false"

    run-matrix-upload-package-name:
        description: "Package name for failure artifact filename (required if run-matrix-prepare-upload is true)"
        required: false

    run-matrix-upload-package-os:
        description: "Package OS for failure artifact filename (required if run-matrix-prepare-upload is true)"
        required: false

outputs:
    matrix:
        description: "Generated matrix JSON for GitHub Actions"
        value: ${{ steps.run-action.outputs.matrix }}

    raw-output:
        description: "Raw output from clippier before transformation"
        value: ${{ steps.run-action.outputs.raw-output }}

    affected:
        description: "Whether target package is affected (for affected-packages command)"
        value: ${{ steps.run-action.outputs.affected }}

    reasoning:
        description: "Reasoning output (when include-reasoning is enabled)"
        value: ${{ steps.run-action.outputs.reasoning }}

    git-base:
        description: "Detected or provided git base SHA"
        value: ${{ steps.run-action.outputs.git-base }}

    git-head:
        description: "Detected or provided git head SHA"
        value: ${{ steps.run-action.outputs.git-head }}

    has-changes:
        description: "Whether any changes were detected"
        value: ${{ steps.run-action.outputs.has-changes }}

    docker-matrix:
        description: "Generated Docker build matrix (when enable-docker-analysis is true)"
        value: ${{ steps.run-action.outputs.docker-matrix }}

    has-docker-changes:
        description: "Whether any Docker packages are affected"
        value: ${{ steps.run-action.outputs.has-docker-changes }}

    docker-count:
        description: "Number of Docker images to build"
        value: ${{ steps.run-action.outputs.docker-count }}

    docker-packages-list:
        description: "Formatted list of Docker packages for summary"
        value: ${{ steps.run-action.outputs.docker-packages-list }}

    additional-checks:
        description: 'Results from additional-package-checks as JSON object keyed by output-key (e.g., {"tauri": {"affected": true, "reasoning": [...]}})'
        value: ${{ steps.run-action.outputs.additional-checks }}

    # Outputs for run-matrix command
    run-results:
        description: "Detailed test results as JSON"
        value: ${{ steps.run-action.outputs.run-results }}

    run-success:
        description: "Overall success status (true/false)"
        value: ${{ steps.run-action.outputs.run-success }}

    run-total:
        description: "Total number of command runs"
        value: ${{ steps.run-action.outputs.run-total }}

    run-passed:
        description: "Number of passed runs"
        value: ${{ steps.run-action.outputs.run-passed }}

    run-failed:
        description: "Number of failed runs"
        value: ${{ steps.run-action.outputs.run-failed }}

    failure-artifact-path:
        description: "Path to prepared failure artifact file (for run-matrix-flush with prepare-upload enabled)"
        value: ${{ steps.run-action.outputs.failure-artifact-path }}

    failure-artifact-name:
        description: "Stable artifact name generated from matrix package JSON (for run-matrix-flush with prepare-upload enabled)"
        value: ${{ steps.run-action.outputs.failure-artifact-name }}

runs:
    using: "composite"
    steps:
        - name: Checkout repository
          if: inputs.command == 'setup' && inputs.skip-checkout != 'true'
          uses: actions/checkout@v4
          with:
              fetch-depth: ${{ inputs.checkout-fetch-depth }}
              submodules: ${{ fromJson(inputs.package-json).gitSubmodules || false }}

        - name: Free disk space
          if: |
              inputs.command == 'setup' &&
              runner.os == 'Linux' && (
                  contains(fromJson(inputs.package-json).toolchains || '[]', 'free_disk_space') ||
                  contains(fromJson(inputs.package-json).ciToolchains || '[]', 'free_disk_space')
              )
          uses: jlumbroso/free-disk-space@main
          with:
              tool-cache: true

        - name: Setup Rust toolchain
          if: inputs.command == 'setup'
          uses: dtolnay/rust-toolchain@stable
          with:
              toolchain: ${{ fromJson(inputs.package-json).nightly && 'nightly' || 'stable' }}
              components: ${{ inputs.rust-components }}

        - name: Setup pnpm
          if: inputs.command == 'setup' && (contains(fromJson(inputs.package-json).toolchains || '[]', 'node') || contains(fromJson(inputs.package-json).ciToolchains || '[]', 'node'))
          uses: pnpm/action-setup@v3
          with:
              version: 9

        - name: Setup Node.js
          if: inputs.command == 'setup' && (contains(fromJson(inputs.package-json).toolchains || '[]', 'node') || contains(fromJson(inputs.package-json).ciToolchains || '[]', 'node'))
          uses: actions/setup-node@v4
          with:
              node-version: latest

        - name: Setup cmake
          if: inputs.command == 'setup'
          uses: jwlawson/actions-setup-cmake@v2
          with:
              cmake-version: "3.x"

        - name: Checkout MoosicBox for clippier
          if: |
              inputs.clippier-version != '' && (
                inputs.command == 'features' ||
                inputs.command == 'packages' ||
                inputs.command == 'affected-packages' ||
                inputs.command == 'workspace-deps' ||
                inputs.command == 'validate-feature-propagation'
              )
          uses: actions/checkout@v4
          with:
              repository: MoosicBox/MoosicBox
              ref: ${{ inputs.clippier-version }}
              path: .clippier-source

        - name: Cache clippier binary
          if: |
              inputs.skip-cache != 'true' && (
                inputs.command == 'features' ||
                inputs.command == 'packages' ||
                inputs.command == 'affected-packages' ||
                inputs.command == 'workspace-deps' ||
                inputs.command == 'validate-feature-propagation'
              )
          uses: actions/cache@v4
          with:
              path: ./target/release/clippier
              key: ${{ inputs.cache-key-prefix }}-${{ runner.os }}-${{ inputs.clippier-version || 'local' }}-${{ hashFiles('packages/clippier/**') }}

        - name: Build clippier
          if: |
              inputs.command == 'features' ||
              inputs.command == 'packages' ||
              inputs.command == 'affected-packages' ||
              inputs.command == 'workspace-deps' ||
              inputs.command == 'validate-feature-propagation'
          shell: bash
          run: |
              if [[ ! -f ./target/release/clippier ]] || [[ "${{ inputs.skip-cache }}" == "true" ]]; then
                echo "Building clippier with features: ${{ inputs.clippier-features }}"

                if [[ -n "${{ inputs.clippier-version }}" ]]; then
                  echo "Building clippier from MoosicBox@${{ inputs.clippier-version }}"
                  cd .clippier-source
                  cargo build --package clippier --features "${{ inputs.clippier-features }}" --release
                  mkdir -p ../target/release
                  cp target/release/clippier ../target/release/
                  cd ..
                else
                  echo "Building clippier from local repository"
                  cargo build --package clippier --features "${{ inputs.clippier-features }}" --release
                fi

                chmod +x ./target/release/clippier
              else
                echo "Using cached clippier binary"
              fi

        - name: Run clippier action
          id: run-action
          shell: bash
          working-directory: ${{ github.action_path }}
          run: ./action.sh
          env:
              INPUT_COMMAND: ${{ inputs.command }}
              INPUT_WORKSPACE_PATH: ${{ inputs.workspace-path }}
              INPUT_OS: ${{ inputs.os }}
              INPUT_OFFSET: ${{ inputs.offset }}
              INPUT_MAX: ${{ inputs.max }}
              INPUT_MAX_PARALLEL: ${{ inputs.max-parallel }}
              INPUT_CHUNKED: ${{ inputs.chunked }}
              INPUT_SPREAD: ${{ inputs.spread }}
              INPUT_RANDOMIZE: ${{ inputs.randomize }}
              INPUT_SEED: ${{ inputs.seed }}
              INPUT_FEATURES: ${{ inputs.features }}
              INPUT_SKIP_FEATURES: ${{ inputs.skip-features }}
              INPUT_STRICT_OPTIONAL: ${{ inputs.strict-optional }}
              INPUT_REQUIRED_FEATURES: ${{ inputs.required-features }}
              INPUT_PACKAGES: ${{ inputs.packages }}
              INPUT_SKIP_IF: ${{ inputs.skip-if }}
              INPUT_INCLUDE_IF: ${{ inputs.include-if }}
              INPUT_CHANGED_FILES: ${{ inputs.changed-files }}
              INPUT_GIT_STRATEGY: ${{ inputs.git-strategy }}
              INPUT_GIT_BASE: ${{ inputs.git-base }}
              INPUT_GIT_HEAD: ${{ inputs.git-head }}
              INPUT_GIT_COMPARE_BRANCH: ${{ inputs.git-compare-branch }}
              INPUT_GIT_WORKFLOW_NAME: ${{ inputs.git-workflow-name }}
              INPUT_GIT_DEFAULT_BRANCH: ${{ inputs.git-default-branch }}
              INPUT_GITHUB_TOKEN: ${{ inputs.github-token }}
              INPUT_GITHUB_REPOSITORY: ${{ inputs.github-repository }}
              INPUT_GITHUB_REF_NAME: ${{ inputs.github-ref-name }}
              INPUT_INCLUDE_REASONING: ${{ inputs.include-reasoning }}
              INPUT_IGNORE_PATTERNS: ${{ inputs.ignore }}
              INPUT_TARGET_PACKAGE: ${{ inputs.target-package }}
              INPUT_PACKAGE: ${{ inputs.package }}
              INPUT_ALL_POTENTIAL_DEPS: ${{ inputs.all-potential-deps }}
              INPUT_ADDITIONAL_PACKAGE_CHECKS: ${{ inputs.additional-package-checks }}
              INPUT_INJECT_REASONING: ${{ inputs.inject-reasoning }}
              INPUT_INJECT_REASONING_CONDITION: ${{ inputs.inject-reasoning-condition }}
              INPUT_FORCE_FULL_MATRIX_CONDITION: ${{ inputs.force-full-matrix-condition }}
              INPUT_SKIP_ON_NO_CHANGES: ${{ inputs.skip-on-no-changes }}
              INPUT_TRANSFORM_NAME_REGEX: ${{ inputs.transform-name-regex }}
              INPUT_TRANSFORM_NAME_REPLACEMENT: ${{ inputs.transform-name-replacement }}
              INPUT_MATRIX_PROPERTIES: ${{ inputs.matrix-properties }}
              INPUT_OS_SUFFIX: ${{ inputs.os-suffix }}
              INPUT_GENERATE_SUMMARY: ${{ inputs.generate-summary }}
              INPUT_SUMMARY_TITLE: ${{ inputs.summary-title }}
              INPUT_SUMMARY_INCLUDE_SEED: ${{ inputs.summary-include-seed }}
              INPUT_SUMMARY_EVENT_NAME: ${{ inputs.summary-event-name }}
              INPUT_SUMMARY_REF_NAME: ${{ inputs.summary-ref-name }}
              INPUT_SUMMARY_TRIGGER_INPUT: ${{ inputs.summary-trigger-input }}
              INPUT_SUMMARY_SHOW_TRIGGER: ${{ inputs.summary-show-trigger }}
              INPUT_SUMMARY_SHOW_JOBS_DETAILS: ${{ inputs.summary-show-jobs-details }}
              INPUT_GENERATE_VALIDATION_SUMMARY: ${{ inputs.generate-validation-summary }}
              INPUT_ENABLE_DOCKER_ANALYSIS: ${{ inputs.enable-docker-analysis }}
              INPUT_DOCKER_PACKAGES: ${{ inputs.docker-packages }}
              INPUT_DOCKER_NAME_PREFIX: ${{ inputs.docker-name-prefix }}
              INPUT_TRANSFORM_SCRIPTS: ${{ inputs.transform-scripts }}
              INPUT_TRANSFORM_TRACE: ${{ inputs.transform-trace }}
              INPUT_PACKAGE_JSON: ${{ inputs.package-json }}
              INPUT_SKIP_CHECKOUT: ${{ inputs.skip-checkout }}
              INPUT_CHECKOUT_FETCH_DEPTH: ${{ inputs.checkout-fetch-depth }}
              INPUT_RUST_COMPONENTS: ${{ inputs.rust-components }}
              INPUT_RUN_MATRIX_PACKAGE_JSON: ${{ inputs.run-matrix-package-json }}
              INPUT_RUN_MATRIX_COMMANDS: ${{ inputs.run-matrix-commands }}
              INPUT_RUN_MATRIX_STRATEGY: ${{ inputs.run-matrix-strategy }}
              INPUT_RUN_MATRIX_CONTINUE_ON_FAILURE: ${{ inputs.run-matrix-continue-on-failure }}
              INPUT_RUN_MATRIX_MAX_OUTPUT_LINES: ${{ inputs.run-matrix-max-output-lines }}
              INPUT_RUN_MATRIX_FAIL_FAST: ${{ inputs.run-matrix-fail-fast }}
              INPUT_RUN_MATRIX_VERBOSE: ${{ inputs.run-matrix-verbose }}
              INPUT_RUN_MATRIX_STREAM_OUTPUT: ${{ inputs.run-matrix-stream-output }}
              INPUT_RUN_MATRIX_WORKING_DIRECTORY: ${{ inputs.run-matrix-working-directory }}
              INPUT_RUN_MATRIX_LABEL: ${{ inputs.run-matrix-label }}
              INPUT_RUN_MATRIX_SKIP_DOCTEST_CHECK: ${{ inputs.run-matrix-skip-doctest-check }}
              INPUT_RUN_MATRIX_GENERATE_SUMMARY: ${{ inputs.run-matrix-generate-summary }}
              INPUT_RUN_MATRIX_SUMMARY_AUTO_EXPAND: ${{ inputs.run-matrix-summary-auto-expand }}
              INPUT_RUN_MATRIX_DEBUG_SHELLS: ${{ inputs.run-matrix-debug-shells }}
              INPUT_RUN_MATRIX_SUMMARY_MODE: ${{ inputs.run-matrix-summary-mode }}
              INPUT_RUN_MATRIX_SUMMARY_ONLY_ON_FAILURE: ${{ inputs.run-matrix-summary-only-on-failure }}
              INPUT_RUN_MATRIX_SUMMARY_FLUSH: ${{ inputs.run-matrix-summary-flush }}
              INPUT_RUN_MATRIX_PREPARE_UPLOAD: ${{ inputs.run-matrix-prepare-upload }}
              INPUT_RUN_MATRIX_PREPARE_UPLOAD_ONLY_ON_FAILURE: ${{ inputs.run-matrix-prepare-upload-only-on-failure }}
              INPUT_RUN_MATRIX_UPLOAD_PACKAGE_NAME: ${{ inputs.run-matrix-upload-package-name }}
              INPUT_RUN_MATRIX_UPLOAD_PACKAGE_OS: ${{ inputs.run-matrix-upload-package-os }}
              GITHUB_EVENT_NAME: ${{ github.event_name }}
              GITHUB_EVENT_BEFORE: ${{ github.event.before }}
              GITHUB_EVENT_AFTER: ${{ github.event.after }}
              GITHUB_EVENT_FORCED: ${{ github.event.forced }}
              GITHUB_BASE_REF: ${{ github.base_ref }}
              GITHUB_SHA: ${{ github.sha }}
              GITHUB_WORKFLOW_REF: ${{ github.workflow_ref }}
