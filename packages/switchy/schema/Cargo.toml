[package]
authors     = { workspace = true }
categories  = ["database", "development-tools"]
description = "Generic schema migration system for switchy_database"
edition     = { workspace = true }
keywords    = ["database", "migration", "schema", "switchy"]
license     = { workspace = true }
name        = "switchy_schema"
readme      = "README.md"
repository  = { workspace = true }
version     = "0.1.0"

[package.metadata.workspaces]
group = "switchy"

[package.metadata.cargo-machete]
ignored = ["tokio"]

[dependencies]
async-trait          = { workspace = true }
chrono               = { workspace = true }
hex                  = { workspace = true }
log                  = { workspace = true }
moosicbox_json_utils = { workspace = true, features = ["database"] }
sha2                 = { workspace = true }
switchy_async        = { workspace = true, features = ["sync"] }
switchy_database     = { workspace = true, features = ["cascade", "schema"] }
thiserror            = { workspace = true }

# Optional dependencies for discovery features
bytes = { workspace = true }
include_dir = { workspace = true, optional = true }
switchy_fs = { workspace = true, optional = true, features = [
    "async",
    "tokio",
] }

[dev-dependencies]
chrono = { workspace = true }
switchy_async = { workspace = true, features = ["macros", "tokio"] }
switchy_database_connection = { workspace = true, features = ["sqlite-sqlx"] }
switchy_fs = { workspace = true, features = ["simulator-real-fs", "std"] }
switchy_schema_test_utils = { workspace = true, features = [
    "snapshots",
    "sqlite",
] }
tempfile = { workspace = true }
test-log = { workspace = true }
tokio = { workspace = true, features = ["macros", "rt"] }

[features]
default = ["all-discovery"]

fail-on-warnings = [
    "switchy_database/fail-on-warnings",
    "switchy_fs?/fail-on-warnings",
]

all-discovery = ["code", "directory", "embedded"]
auto-reverse  = ["switchy_database/auto-reverse"]
code          = []
directory     = ["dep:switchy_fs"]
embedded      = ["dep:include_dir"]
snapshots     = []
test-utils    = []
validation    = []
